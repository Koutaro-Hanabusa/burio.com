# 管理画面アクセス設定

## IP制限の設定方法

管理画面へのアクセスはIP制限で保護されています。本番環境では環境変数でIPアドレスを指定する必要があります。

### 1. 現在のIPアドレスを確認

```bash
curl ifconfig.me
```

### 2. 環境変数の設定

#### Cloudflare Workersの場合

```bash
# Wranglerのシークレットとして設定
wrangler secret put ADMIN_ALLOWED_IPS

# プロンプトで入力する内容（複数IPの場合はカンマ区切り）
# 例: 122.26.120.5,203.0.113.10
```

#### ローカル開発の場合

`.env`ファイルに追加：

```env
ADMIN_ALLOWED_IPS=122.26.120.5,203.0.113.10
```

#### 本番環境（その他クラウドプロバイダー）

プラットフォームに応じて環境変数を設定：

```env
ADMIN_ALLOWED_IPS=122.26.120.5,203.0.113.10
```

### 3. IPアドレス形式

- **完全一致**: `122.26.120.5`
- **プレフィックス一致**: `192.168.` (この場合192.168.x.xのすべて)
- **複数指定**: カンマ区切り `122.26.120.5,203.0.113.10`

### 4. 自動で含まれるIP

以下のIPアドレスは自動的に許可されます（開発用）：

- `127.0.0.1` (localhost)
- `::1` (localhost IPv6)  
- `192.168.` (ローカルネットワーク)
- `10.` (プライベートIP)
- `172.16.` (プライベートIP)

### 5. 開発環境での動作

`NODE_ENV=development`の場合、すべてのIPからのアクセスが許可されます。

### 6. トラブルシューティング

#### アクセスが拒否される場合

1. 現在のIPアドレスを確認
2. 環境変数が正しく設定されているか確認
3. Cloudflare Workersの場合、シークレットが正しくデプロイされているか確認

#### IPアドレスが変わった場合

動的IPを使用している場合、IPアドレスが変わることがあります：

1. 新しいIPアドレスを確認
2. 環境変数を更新
3. サービスを再デプロイ

### 7. セキュリティのベストプラクティス

- IPアドレスをコードに直書きしない
- 定期的にアクセスログを確認
- 不要なIPアドレスは削除
- VPN経由でのアクセスを検討